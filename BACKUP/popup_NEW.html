<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>CAPUSTA - Financial Calculator Pro</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ FontAwesome 5.15.4 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>

  <div class="container">

    <!-- TOP NAVIGATION -->
    <div class="top-bar">
      <div class="nav-group">
        <button class="tab-btn active" data-tab="calculator"><i class="fas fa-calculator mr-1"></i> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
        <button class="tab-btn" data-tab="crm"><i class="fas fa-briefcase mr-1"></i> CRM</button>
        <button class="tab-btn" data-tab="price"><i class="fas fa-tags mr-1"></i> –ü—Ä–∞–π—Å</button>
        <button class="tab-btn" data-tab="settings"><i class="fas fa-cog mr-1"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      </div>
      <div class="nav-group">
        <button class="action-btn" id="saveAllBtn" style="display:none;"><i class="fas fa-save mr-1"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="action-btn" id="exportBtn"><i class="fas fa-file-export mr-1"></i> –≠–∫—Å–ø–æ—Ä—Ç</button>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="content-area">

      <!-- ============================================
           TAB: –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†
           ============================================ -->
      <div id="tab-calculator" class="tab-content" style="display: block;">
        
        <!-- 1.1 –°–µ–∫—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–∞ -->
        <div class="section">
          <div class="section-title">
            <span><i class="fas fa-link mr-1"></i> –î–∞–Ω–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏</span>
            <button class="btn-secondary" id="reParseBtn"><i class="fas fa-sync-alt mr-1"></i> –ü–µ—Ä–µ–ø–∞—Ä—Å–∏—Ç—å</button>
          </div>
          
          <div style="display:grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-bottom: 10px;">
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫—É–ø–∫—É</label>
              <input type="text" id="tenderUrl" placeholder="https://zakupki.kontur.ru/...">
            </div>
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
              <input type="date" id="tenderDeadline">
            </div>
          </div>

          <div style="display:grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–ó–∞–∫–∞–∑—á–∏–∫</label>
              <input type="text" id="customerName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏">
            </div>
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–ò–ù–ù</label>
              <input type="text" id="customerInn" placeholder="1234567890">
            </div>
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–ö–ü–ü</label>
              <input type="text" id="customerKpp" placeholder="123456789">
            </div>
          </div>

          <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px;">
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–ö–æ–Ω—Ç–∞–∫—Ç (–§–ò–û)</label>
              <input type="text" id="contactName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
            </div>
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–¢–µ–ª–µ—Ñ–æ–Ω</label>
              <input type="tel" id="contactPhone" placeholder="+7 (999) 123-45-67">
            </div>
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">Email</label>
              <input type="email" id="contactEmail" placeholder="example@mail.ru">
            </div>
          </div>

          <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px;">
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–ù–ú–¶</label>
              <input type="number" id="nmcValue" placeholder="0">
            </div>
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–û–±–µ—Å–ø. –∑–∞—è–≤–∫–∏</label>
              <input type="number" id="bidSecurity" placeholder="0">
              <span style="font-size: 9px; color: var(--text-muted);" id="bidSecurityCalc"></span>
            </div>
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–û–±–µ—Å–ø. –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞</label>
              <input type="number" id="contractSecurity" placeholder="0">
              <span style="font-size: 9px; color: var(--text-muted);" id="contractSecurityCalc"></span>
            </div>
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–¢–∞—Ä–∏—Ñ</label>
              <select id="tariffType">
                <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                <option value="premium">–ü—Ä–µ–º–∏—É–º</option>
              </select>
            </div>
          </div>

          <div style="display:grid; grid-template-columns: 1fr 1fr 2fr; gap: 10px; margin-bottom: 10px;">
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–ö–æ–ª-–≤–æ –ß–ß</label>
              <input type="number" id="totalHours" placeholder="0">
            </div>
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–°—Ä–µ–¥–Ω—è—è —Å—Ç. —á–∞—Å–∞</label>
              <input type="number" id="avgRate" placeholder="0.00" step="0.01">
            </div>
            <div>
              <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–°—Ä–æ–∫ –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥</label>
              <div style="display: flex; gap: 6px;">
                <input type="date" id="serviceStart" style="flex: 1;">
                <input type="date" id="serviceEnd" style="flex: 1;">
                <input type="number" id="serviceMonths" placeholder="–º–µ—Å" style="width: 50px;" readonly>
              </div>
            </div>
          </div>

          <div style="margin-bottom: 10px;">
            <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–ê–¥—Ä–µ—Å–∞ –æ–±—ä–µ–∫—Ç–æ–≤</label>
            <textarea id="addresses" rows="2" placeholder="–ê–¥—Ä–µ—Å 1&#10;–ê–¥—Ä–µ—Å 2"></textarea>
          </div>

          <div>
            <label style="font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 2px;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>
            <textarea id="comments" rows="3" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∑–∞–∫—É–ø–∫–µ (–∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)"></textarea>
          </div>
        </div>

        <!-- 1.2 –†–∞—Å—á–µ—Ç –æ—Ö—Ä–∞–Ω—ã -->
        <div class="section">
          <div class="section-title">
            <span><i class="fas fa-shield-alt mr-1"></i> –†–∞—Å—á–µ—Ç –æ—Ö—Ä–∞–Ω—ã</span>
          </div>
          
          <div class="summary-card">
            <div class="summary-grid">
              <div class="summary-item">
                <div class="summary-label">–ò—Ç–æ–≥–æ —á–∞—Å–æ–≤</div>
                <div class="summary-value" id="totalHoursCalc">0</div>
              </div>
              <div class="summary-item">
                <div class="summary-label">–ò—Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫</div>
                <div class="summary-value" id="totalPeopleCalc">0</div>
              </div>
              <div class="summary-item">
                <div class="summary-label">–°—Ä–µ–¥–Ω—è—è —Å—Ç–∞–≤–∫–∞</div>
                <div class="summary-value" id="avgRateCalc">0.00</div>
              </div>
              <div class="summary-item">
                <div class="summary-label highlight">–û–±—â–∞—è —Å—É–º–º–∞</div>
                <div class="summary-value highlight" id="totalAmountCalc">0.00</div>
              </div>
            </div>
          </div>

          <div style="background: var(--bg-tertiary); padding: 8px; border-radius: var(--radius-md); margin-bottom: 10px;">
            <div style="font-size: 9px; color: var(--text-muted); margin-bottom: 2px;">–û—Å—Ç–∞—Ç–æ–∫ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</div>
            <div style="display: flex; justify-content: space-between; font-size: 11px;">
              <span>–ß–∞—Å—ã: <strong id="remainingHours">0</strong></span>
              <span>–°—É–º–º–∞: <strong id="remainingAmount">0.00</strong></span>
            </div>
          </div>

          <table class="data-grid" id="securityCalcTable">
            <thead>
              <tr>
                <th style="width: 20%;">–¢–∏–ø –ø–æ—Å—Ç–∞</th>
                <th style="width: 25%;">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th style="width: 10%;">–ß–ß/–º–µ—Å</th>
                <th style="width: 8%;">–ú–µ—Å</th>
                <th style="width: 12%;">–°—Ç. —á–∞—Å</th>
                <th style="width: 12%;">–í –º–µ—Å</th>
                <th style="width: 10%;">–ò—Ç–æ–≥–æ</th>
                <th style="width: 3%;"></th>
              </tr>
            </thead>
            <tbody id="securityRowsBody"></tbody>
          </table>
          <button class="btn-icon" id="addCalcRowBtn" style="margin-top: 6px;"><i class="fas fa-plus"></i></button>
        </div>

        <!-- 1.3 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã -->
        <div class="section">
          <div class="section-title">
            <span><i class="fas fa-coins mr-1"></i> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</span>
          </div>
          
          <div class="summary-card">
            <div class="summary-grid">
              <div class="summary-item">
                <div class="summary-label">–î–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã</div>
                <div class="summary-value" id="extraTotalCalc">0.00</div>
              </div>
              <div class="summary-item">
                <div class="summary-label highlight">–ò—Ç–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç</div>
                <div class="summary-value highlight" id="grandTotalContract">0.00</div>
              </div>
            </div>
          </div>

          <table class="data-grid" id="extraExpensesTable">
            <thead>
              <tr>
                <th style="width: 35%;">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th style="width: 15%;">–ö–æ–ª-–≤–æ</th>
                <th style="width: 18%;">–¶–µ–Ω–∞</th>
                <th style="width: 15%;">–ü–µ—Ä–∏–æ–¥</th>
                <th style="width: 12%;">–ò—Ç–æ–≥–æ</th>
                <th style="width: 3%;"></th>
              </tr>
            </thead>
            <tbody id="extraRowsBody"></tbody>
          </table>
          <button class="btn-icon" id="addExtraRowBtn" style="margin-top: 6px;"><i class="fas fa-plus"></i></button>
        </div>

        <!-- 1.4 –°—Ö–µ–º—ã —Ä–∞—Å—á–µ—Ç–æ–≤ -->
        <div class="section">
          <div class="section-title"><i class="fas fa-chart-line mr-1"></i> –°—Ö–µ–º—ã —Ä–∞—Å—á–µ—Ç–æ–≤</div>
          
          <div class="summary-grid" style="margin-bottom: 15px;">
            <div class="summary-item"><span class="summary-label">–ë–ï–õ –£–°–ù</span><span class="summary-value" id="rentBELUSN">0%</span></div>
            <div class="summary-item"><span class="summary-label">–°–ï–† –£–°–ù</span><span class="summary-value" id="rentSERUSN">0%</span></div>
            <div class="summary-item"><span class="summary-label">–ë–ï–õ –ù–î–°</span><span class="summary-value" id="rentBELNDS">0%</span></div>
            <div class="summary-item"><span class="summary-label">–°–ï–† –ù–î–°</span><span class="summary-value" id="rentSERNDS">0%</span></div>
            <div class="summary-item"><span class="summary-label">–ò–ü –ù–î–°</span><span class="summary-value" id="rentIPNDS">0%</span></div>
          </div>

          <div id="schemesDetailsContainer"></div>
        </div>

      </div>

      <!-- ========== CRM –ú–û–î–£–õ–¨ ========== -->
      <div id="tab-crm" class="tab-content" style="display:none;">
        <div style="display: flex; gap: 6px; margin-bottom: 12px; border-bottom: 1px solid var(--border-subtle); padding-bottom: 6px;">
          <button class="tab-btn active" data-subtab="deals"><i class="fas fa-handshake mr-1"></i> –°–¥–µ–ª–∫–∏</button>
          <button class="tab-btn" data-subtab="tasks"><i class="fas fa-tasks mr-1"></i> –ó–∞–¥–∞—á–∏</button>
          <button class="tab-btn" data-subtab="counterparties"><i class="fas fa-building mr-1"></i> –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã</button>
          <button class="tab-btn" data-subtab="managers"><i class="fas fa-users mr-1"></i> –ú–µ–Ω–µ–¥–∂–µ—Ä—ã</button>
        </div>

        <div id="crm-deals" class="crm-subtab" style="display:block;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <input type="text" id="dealsSearch" placeholder="üîç –ü–æ–∏—Å–∫ —Å–¥–µ–ª–æ–∫" style="flex: 1; margin-right: 10px;">
            <select id="dealsSort" style="width: 120px;">
              <option value="deadline">–î–µ–¥–ª–∞–π–Ω</option>
              <option value="profit">–†–µ–Ω—Ç.</option>
              <option value="nmc">–ù–ú–¶</option>
            </select>
          </div>
          <div id="dealsContainer"></div>
        </div>

        <div id="crm-tasks" class="crm-subtab">
          <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <input type="text" id="tasksSearch" placeholder="üîç –ü–æ–∏—Å–∫ –∑–∞–¥–∞—á" style="flex: 1; margin-right: 10px;">
            <button class="btn-primary" id="addTaskBtn"><i class="fas fa-plus mr-1"></i> –ó–∞–¥–∞—á–∞</button>
          </div>
          <div id="tasksContainer"></div>
        </div>

        <div id="crm-counterparties" class="crm-subtab">
          <input type="text" id="counterpartiesSearch" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –ò–ù–ù –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—é" style="width: 100%; margin-bottom: 10px;">
          <table class="data-grid" id="counterpartiesTable">
            <thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ò–ù–ù</th><th>–ö–ü–ü</th><th>–°–¥–µ–ª–æ–∫</th><th>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th></tr></thead>
            <tbody id="counterpartiesBody"></tbody>
          </table>
        </div>

        <div id="crm-managers" class="crm-subtab">
          <button class="btn-primary" id="addManagerBtn" style="margin-bottom: 10px;"><i class="fas fa-user-plus mr-1"></i> –ú–µ–Ω–µ–¥–∂–µ—Ä</button>
          <table class="data-grid" id="managersTable">
            <thead><tr><th>–§–ò–û</th><th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>Email</th><th></th></tr></thead>
            <tbody id="managersBody"></tbody>
          </table>
        </div>
      </div>

      <!-- TAB: –ü–†–ê–ô–° -->
      <div id="tab-price" class="tab-content">
        <div class="section">
          <div class="section-title">
            <span><i class="fas fa-shield-alt mr-1"></i> –ü—Ä–∞–π—Å: –æ—Ö—Ä–∞–Ω–∞</span>
            <button class="btn-icon" id="addPriceRowBtn"><i class="fas fa-plus"></i></button>
          </div>
          <table class="data-grid">
            <thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–†–µ–≥–∏–æ–Ω</th><th style="text-align:center">–û—Ä.</th><th>–í–∞—Ö—Ç–∞</th><th>–ß–ß</th><th>–°—Ç–∞–≤–∫–∞</th><th style="text-align:right">–ò—Ç–æ–≥–æ</th><th></th></tr></thead>
            <tbody id="priceTableBody"></tbody>
          </table>
        </div>
        <div class="section">
          <div class="section-title">
            <span><i class="fas fa-money-bill mr-1"></i> –ü—Ä–∞–π—Å: –¥–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã</span>
            <button class="btn-icon" id="addExtraPriceRowBtn"><i class="fas fa-plus"></i></button>
          </div>
          <table class="data-grid">
            <thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–¶–µ–Ω–∞</th><th>–¢–∏–ø</th><th></th></tr></thead>
            <tbody id="extraPriceTableBody"></tbody>
          </table>
        </div>
        <div style="text-align: right;">
          <button class="btn-primary" id="savePriceBtn"><i class="fas fa-check-circle mr-1"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–π—Å</button>
        </div>
      </div>

      <!-- TAB: –ù–ê–°–¢–†–û–ô–ö–ò -->
      <div id="tab-settings" class="tab-content">
        <div class="section">
          <div class="section-title"><span><i class="fas fa-sliders-h mr-1"></i> –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤</span></div>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
            <div><label style="font-size:9px;color:var(--text-muted);">–ú–†–û–¢</label><input type="number" id="var_mrot" value="27093"></div>
            <div><label style="font-size:9px;color:var(--text-muted);">–ù–î–§–õ (%)</label><input type="number" id="var_ndfl" value="13"></div>
            <div><label style="font-size:9px;color:var(--text-muted);">–£–°–ù (%)</label><input type="number" id="var_usn" value="6"></div>
            <div><label style="font-size:9px;color:var(--text-muted);">–û–°–ù (%)</label><input type="number" id="var_osn" value="22"></div>
            <div><label style="font-size:9px;color:var(--text-muted);">–ù–∞–ª–æ–≥ –Ω–∞ –ø—Ä–∏–±—ã–ª—å (%)</label><input type="number" id="var_profit_tax" value="25"></div>
            <div><label style="font-size:9px;color:var(--text-muted);">–î–∏–≤–∏–¥–µ–Ω–¥—ã (–∫–æ—ç—Ñ.)</label><input type="number" id="var_dividend" value="0.85" step="0.01"></div>
          </div>
        </div>

        <div class="section">
          <div class="section-title"><span><i class="fab fa-telegram-plane mr-1"></i> Telegram Bot</span></div>
          <div style="display: flex; flex-direction: column; gap: 8px;">
            <div><input type="text" id="tgUser" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (@)"></div>
            <div><input type="password" id="tgToken" placeholder="API Token"></div>
          </div>
        </div>

        <div class="section">
          <div class="section-title"><span><i class="fas fa-scroll mr-1"></i> –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è</span></div>
          <textarea id="calcSpecArea" rows="8" readonly style="font-size: 10px; color: var(--text-muted);"></textarea>
        </div>

        <div style="text-align: right;">
          <button class="btn-primary" id="saveSettingsBtn"><i class="fas fa-save mr-1"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>
      </div>

    </div> <!-- –ö–æ–Ω–µ—Ü .content-area -->

  </div> <!-- –ö–æ–Ω–µ—Ü .container -->

  <!-- SCRIPTS -->
  <script src="rules.js"></script>
  <script src="data.js"></script>
  <script src="calculator.js"></script>
  <script src="app.js"></script>

</body>
</html>
