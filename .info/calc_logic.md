# ЕДИНАЯ СПЕЦИФИКАЦИЯ ЛОГИКИ КАЛЬКУЛЯТОРА (UNIFIED CALC SPECS)

Этот документ объединяет всю логику расчетов, формулы и справочные данные для переноса Excel-калькулятора в JavaScript.
**Цель:** Создать точный JS-калькулятор рентабельности на основе описанных ниже схем и формул.

---

## 1. ВВОДНЫЕ ДАННЫЕ (INPUTS)

Переменные, которые пользователь вводит или выбирает (из листа "Дано").

| Переменная | Ячейка (Ref) | Значение по умолчанию | Описание |
|---|---|---|---|
| **Стоимость контракта** | `B5` | 474 500 | Месячная выручка (общая) |
| **Ставка сотрудника** | `B10` | 4 500 | Рублей в день (на руки/грязными - зависит от схемы) |
| **Кол-во сотрудников** | `C10` | 1 | Количество основных сотрудников |
| **Ставка НОО/Бух** | `B12` | 3 000 | Рублей в день (управленческий персонал) |
| **Кол-во НОО/Бух** | `C12` | 1 | Количество управленцев |
| **Дней в месяце** | - | 30.5 | Константа для расчетов ФОТ |
| **Доп. расходы** | `B14`..`F38` | - | Различные доп. расходы (Связь, ГСМ, Проживание) |

---

## 2. СПРАВОЧНИК ФОРМУЛ И АЛГОРИТМОВ (CORE LOGIC)

Эти формулы используются во всех схемах. Реализуйте их как отдельные функции.

### 2.1. Метод ГРОСС-АП (Обратный расчет ЗП)
Используется в "Белых" схемах для расчета суммы в договоре, чтобы сотрудник получил желаемое "на руки".
> **Формула:** `Contract_Sum = (Net_Salary + Vacation_Reserve) / 0.87 * (100 / 87)`
> *Примечание: Коэффициент 0.87 = 1 - 13% НДФЛ.*

### 2.2. Расчет Резерва Отпуска
> **Формула:** `Reserve = (Salary_Total / 29.3) * (28 / 12)`
> *Где:* 29.3 — ср. дней в месяце, 28 — дней отпуска, 12 — месяцев.

### 2.3. Выделение НДС из цены
Если сумма уже включает НДС, нужно выделить налог:
> **НДС 7%:** `VAT = Price / 107 * 7`
> **НДС 22%:** `VAT = Price / 122 * 22`

### 2.4. Комиссия за Обнал / Конверт
Используется в "Серых" схемах.
> **Формула:** `Fee = Amount / 0.85 * 0.15`
> *Логика:* Чтобы получить `Amount` на руки, нужно провести `Amount/0.85`, из которых 15% уйдет на налог/комиссию.

### 2.5. Налог на Прибыль (2025)
> **Ставка:** 25% (новая ставка с 2025 года).
> **Логика:** `Profit_Tax = (Revenue_NoVAT - Expenses) * 0.25` (если прибыль > 0).

---

## 3. ЛОГИКА РАСЧЕТА ПО СХЕМАМ

### СХЕМА 1: БЕЛ УСН (Белая Упрощенка)
*Полностью легальная, весь ФОТ белый, НДС 7%.*

**A. Выручка**
- `D8 (Total Revenue)` = Входящая сумма контракта (B5 * C5).

**B. ФОТ (Фонд Оплаты Труда)**
- `D10 (Staff Salary)` = Ставка * Кол-во * 30.5
- `D11 (Staff Vacation)` = Резерв отпуска от D10
- `D12/D13 (Admin Salary)` = Аналогично для НОО/Бух
- `D15 (Real FOT)` = Сумма всех реальных потребностей на ЗП (D10..D14)

**C. Официальная Зарплата (ГРОСС-АП)**
- `D17 (Official Contract)` = Применяем **Метод ГРОСС-АП** к (D10+D11) и (D12+D13).
- *Цель:* В договоре пишем сумму больше, чтобы после вычета 13% сотрудник получил свой Реальный ФОТ.

**D. Налоги с ФОТ**
- `D21 (NDFL 13%)` = D17 * 0.13
- `D22 (PFR 30%)` = D17 * 0.30
- `D23 (FSS 0.2%)` = D17 * 0.002
- `D24 (Total Tax)` = Сумма D21..D23

**E. Расходы и Прибыль**
- `D27 (VAT 7%)` = D8 / 107 * 7 (Выделяем НДС)
- `D28 (USN 6%)` = (D8 - D27) * 0.06 (Налог УСН от базы без НДС)
- `D40 (Total Expenses)` = НДС + УСН + Налоги с ФОТ + (Офиц.ЗП - НДФЛ)
- `D42 (Profit Cashless)` = Выручка - Расходы
- `D44 (Profit Cash)` = D42 * 0.85 (вычет 15% на вывод)

---

### СХЕМА 2: СЕР УСН (Серая Упрощенка)
*Минималка официально, остальное — дивиденды (15%).*

**Отличия в расчетах:**
1. **Официальная ЗП (`D17`):** Не считается ГРОСС-АПом. Это **фиксированная сумма** (напр. МРОТ или 45 000 руб).
2. **Налоги с ФОТ (`D24`):** Считаются ТОЛЬКО от фиксированной официальной ЗП. Это дает экономию.
3. **Конверт (`D32`):** `Real_FOT (D15)` - `Paid_Officially (D17 - NDFL)`. Это "недоплаченный" остаток.
4. **Налог на дивиденды (`D33`):** Рассчитывается от Конверта по формуле `Envelope / 0.85 * 0.15`.
5. **Расходы (`D40`):** Включают Налоги с фикс. части + Выплата фикс. части + Налог на дивиденды.

---

### СХЕМА 3: БЕЛ НДС (Белая ОСНО)
*Классическая общая система, НДС 22%, Налог на прибыль 25%.*

**Отличия в расчетах:**
1. **Выручка (`D5`):** Пересчитывается! Старый НДС (7%) убираем, новый (22%) добавляем.
   `New_Revenue = (Input / 1.07) * 1.22`
2. **ФОТ:** Считается как в БЕЛ УСН (Гросс-ап, полностью белый).
3. **НДС к уплате (`D27`):** `(Revenue / 122 * 22) - Input_VAT`.
4. **Налог на прибыль (`D41`):** `(Revenue_NoVAT - All_Expenses) * 0.25`. *Важно: Ставка 25% с 2025 года.*

---

### СХЕМА 4: ИП НДС
*Гибрид: НДС платим, но ЗП минимизируем (ИП), остаток через обнал.*

**Отличия в расчетах:**
1. **Выручка:** Как в БЕЛ НДС.
2. **ФОТ:** Как в СЕР УСН (Фиксированная минималка ~45к).
3. **Обнал (`D35`):** Остаток ЗП (Конверт) выводится не дивидендами, а через "Обнал".
4. **Комиссия Обнала (`D36`):** `Cash_Needed / 0.85 * 0.15` (примерно 17.6%).
5. **Входящий НДС (`D38`):** Комиссия обнала и сам обнал могут генерировать "бумажный" НДС к вычету (зависит от "качества" схемы). В формуле: `(Cash + Fee) / 105 * 5`.

---

### СХЕМА 5: СЕР НДС-РИСКИ
*Агрессивная схема с дорогим бумажным НДС.*

**Отличия в расчетах:**
1. **Комиссия Обнала:** Очень высокая!
   `Fee = Cash_Needed / 78 * 22` (около 28%).
2. Используется для максимального закрытия НДС, но является самой рискованной.

---

## 4. ПРОВЕРОЧНЫЕ ЗНАЧЕНИЯ (VERIFICATION)
Используйте эти цифры для unit-тестов.

| Показатель | Бел УСН | Сер УСН | Бел НДС |
|---|---|---|---|
| Выручка | 474 500 | 474 500 | 541 018 |
| Офиц. ЗП | ~174 044 | 45 000 | ~174 044 |
| Налоги ФОТ | ~75 187 | ~19 440 | ~75 187 |
| Рентабельность | ~32.3% | ~38.7% | ~16.4% |

---
**Примечание:** Все коэффициенты (ставки налогов) вынесите в отдельный конфигурационный файл JS, чтобы их можно было легко менять (например, если НДФЛ станет 15%).
