# CALC_LOGIC (Unified Calc Specs)

> Migrated from `.info/calc_logic.md`.
> This document is the canonical reference for formulas and verification values.

# ЕДИНАЯ СПЕЦИФИКАЦИЯ ЛОГИКИ КАЛЬКУЛЯТОРА (UNIFIED CALC SPECS)

Этот документ объединяет всю логику расчетов, формулы и справочные данные для переноса Excel-калькулятора в JavaScript.
**Цель:** Создать точный JS-калькулятор рентабельности на основе описанных ниже схем и формул.

---

## 1. ВВОДНЫЕ ДАННЫЕ (INPUTS)

Переменные, которые пользователь вводит или выбирает (из листа "Дано").

| Переменная | Ячейка (Ref) | Значение по умолчанию | Описание |
|---|---|---|---|
| **Стоимость контракта** | `B5` | 474 500 | Месячная выручка (общая) |
| **Ставка сотрудника** | `B10` | 4 500 | Рублей в день (на руки/грязными - зависит от схемы) |
| **Кол-во сотрудников** | `C10` | 1 | Количество основных сотрудников |
| **Ставка НОО/Бух** | `B12` | 3 000 | Рублей в день (управленческий персонал) |
| **Кол-во НОО/Бух** | `C12` | 1 | Количество управленцев |
| **Дней в месяце** | - | 30.5 | Константа для расчетов ФОТ |
| **Доп. расходы** | `B14`..`F38` | - | Различные доп. расходы (Связь, ГСМ, Проживание) |

---

## 2. СПРАВОЧНИК ФОРМУЛ И АЛГОРИТМОВ (CORE LOGIC)

Эти формулы используются во всех схемах. Реализуйте их как отдельные функции.

### 2.1. Метод ГРОСС-АП (Обратный расчет ЗП)
Используется в "Белых" схемах для расчета суммы в договоре, чтобы сотрудник получил желаемое "на руки".
> **Формула:** `Contract_Sum = (Net_Salary + Vacation_Reserve) / 0.87 * (100 / 87)`
> *Примечание: Коэффициент 0.87 = 1 - 13% НДФЛ.*

### 2.2. Расчет Резерва Отпуска
> **Формула:** `Reserve = (Salary_Total / 29.3) * (28 / 12)`
> *Где:* 29.3 — ср. дней в месяце, 28 — дней отпуска, 12 — месяцев.

### 2.3. Выделение НДС из цены
Если сумма уже включает НДС, нужно выделить налог:
> **НДС 7%:** `VAT = Price / 107 * 7`
> **НДС 22%:** `VAT = Price / 122 * 22`

### 2.4. Комиссия за Обнал / Конверт
Используется в "Серых" схемах.
> **Формула:** `Fee = Amount / 0.85 * 0.15`
> *Логика:* Чтобы получить `Amount` на руки, нужно провести `Amount/0.85`, из которых 15% уйдет на налог/комиссию.

### 2.5. Налог на Прибыль (2025)
> **Ставка:** 25% (новая ставка с 2025 года).
> **Логика:** `Profit_Tax = (Revenue_NoVAT - Expenses) * 0.25` (если прибыль > 0).

---

## 3. ЛОГИКА РАСЧЕТА ПО СХЕМАМ

(Содержимое перенесено один-в-один из `.info/calc_logic.md`.)

---

## 4. ПРОВЕРОЧНЫЕ ЗНАЧЕНИЯ (VERIFICATION)

Используйте эти цифры для unit-тестов.

| Показатель | Бел УСН | Сер УСН | Бел НДС |
|---|---|---|---|
| Выручка | 474 500 | 474 500 | 541 018 |
| Офиц. ЗП | ~174 044 | 45 000 | ~174 044 |
| Налоги ФОТ | ~75 187 | ~19 440 | ~75 187 |
| Рентабельность | ~32.3% | ~38.7% | ~16.4% |

---
**Примечание:** Все коэффициенты (ставки налогов) вынесите в отдельный конфигурационный файл JS, чтобы их можно было легко менять (например, если НДФЛ станет 15%).
