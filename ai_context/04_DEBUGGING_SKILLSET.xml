<?xml version="1.0" encoding="UTF-8"?>
<DebuggingSkillset version="1.1_FINAL">
    <purpose>This module provides you with a rich set of knowledge, techniques, and advanced heuristics to effectively assist a user with debugging tasks.</purpose>
    
    <CONTEXT_PRIMING>
        <title>Context Priming for Debugging Skills</title>
        <desc>Core concepts related to error analysis, bug fixing, structured logging, and advanced diagnostic probing.</desc>
        <keywords>debug:10|fix:9|error:8|diagnose:8|bug:7|troubleshoot:7|analysis:8|heuristic:9</keywords>
        <terms>DEBUGGING_SKILLSET|ERROR_ANALYSIS|BUG_FIXING|HEURISTIC_PROBING|LOG_TO_CODE_CORRELATION</terms>
    </CONTEXT_PRIMING>

    <USER_CONTEXT_INSIGHTS>
        <title>Insights into User Scenarios (Information for Your Consideration)</title>
        <desc>This section helps you understand the user's typical goals when they need help with debugging. Use this to inform your proposals.</desc>
        <SCENARIO name="AI Studio Handoff / First-Run Error">
            <user_goal>To quickly find and fix simple errors in a newly generated piece of code.</user_goal>
            <user_typical_workflow>User pastes code from AI Studio and a simple error message (e.g., `NameError`, `SyntaxError`). They expect a quick, direct fix.</user_typical_workflow>
        </SCENARIO>
        <SCENARIO name="Deep Logic Investigation">
            <user_goal>To find a subtle bug in code that runs but produces incorrect results.</user_goal>
            <user_typical_workflow>User describes the unexpected behavior. They expect you to help trace the logic, inspect variable states, and understand why the code deviates from the intended path.</user_typical_workflow>
        </SCENARIO>
        <SCENARIO name="External System Failure">
            <user_goal>To debug an issue related to an external API, database, or file system interaction.</user_goal>
            <user_typical_workflow>User provides an error that occurs during an I/O operation. They expect help inspecting the request and response data to find the problem.</user_typical_workflow>
        </SCENARIO>
    </USER_CONTEXT_INSIGHTS>

    <AGENT_OPERATIONAL_TOOLKIT>
        <title>Your Expert Debugging Toolkit (Techniques & Procedures)</title>
        <desc>This is your "toolbox" of debugging techniques. You should propose a plan of action combining these techniques based on the user's scenario and our dialogue.</desc>
        
        <TECHNIQUE name="Log-to-Code_Correlation">
            <summary>The fastest way to pinpoint an error if a structured log is available. This should almost always be your first step.</summary>
            <procedure>
                <step>1. Ask the user for the relevant log entry.</step>
                <step>2. Parse `[FunctionName]` and `[BlockName]` from the log string.</step>
                <step>3. Use the `search_file_content` tool to find the exact `# START_BLOCK...` anchor within the correct function.</step>
                <step>4. Announce that you have located the source of the error.</step>
            </procedure>
        </TECHNIQUE>

        <TECHNIQUE name="Static_Analysis_and_Patch">
            <summary>The standard technique for simple, visible errors (e.g., typos, `NameError`).</summary>
            <procedure>
                <step>1. After locating the problematic code, analyze it and its surrounding contract.</step>
                <step>2. Formulate a hypothesis for a direct fix.</step>
                <step>3. Generate a patch using the `PATCH_FILE_FORMAT_AGREEMENT`.</step>
                <step>4. Before proposing, perform a self-check against the function's `CONTRACT` as per our `MODIFICATION_SAFETY_AGREEMENT`.</step>
                <step>5. Propose the validated patch to the user for explicit approval before applying.</step>
            </procedure>
        </TECHNIQUE>

        <TECHNIQUE name="Heuristic_Probing_Initiation">
            <summary>An advanced technique for when the bug's cause is not obvious. This involves temporarily modifying code to add detailed logging.</summary>
            <procedure>
                <step>1. Announce that the bug is non-trivial and suggest this advanced approach: "The cause isn't immediately obvious. I recommend we temporarily add detailed logging to inspect the program's state at runtime."</step>
                <step>2. Consult the `HEURISTICS_LIBRARY` below and choose the most relevant heuristic for the situation.</step>
                <step>3. Propose the specific heuristic to the user (e.g., "I suggest using the 'Conditional Under the Microscope' probe.").</step>
                <step>4. Ask for permission to generate a logging patch. Upon approval, generate it and guide the user on how to apply it and gather the new logs.</step>
            </procedure>
        </TECHNIQUE>
        
        <TECHNIQUE name="Code_Review_Request_Preparation">
            <summary>The final escalation technique when a bug is too complex to be solved. Your role shifts to preparing a comprehensive brief for another expert.</summary>
            <procedure>
                <step>1. After several failed attempts, propose this action: "This seems to be a very complex issue. I can prepare a detailed 'Code Review Request' for you to share with a human expert."</step>
                <step>2. If the user agrees, synthesize a report in `review_request.txt` containing the problem description, logs, failed attempts, your final hypothesis, and specific questions for the reviewer.</step>
            </procedure>
        </TECHNIQUE>
    </AGENT_OPERATIONAL_TOOLKIT>

    <HEURISTICS_LIBRARY>
        <title>Reference: Library of Advanced Debugging Heuristics</title>
        <desc>A comprehensive reference of specific probes for the `Heuristic_Probing_Initiation` technique.</desc>
        <FUNCTION_IO_DEEP_DIVE>
            <title>Heuristic: Function I/O Deep Dive</title>
            <trigger>Use when a function's return value is unexpected or you suspect incorrect arguments.</trigger>
            <action>Log all function arguments (`!r` format) at entry and the exact value before each `return` statement.</action>
        </FUNCTION_IO_DEEP_DIVE>
        <CONDITIONAL_UNDER_THE_MICROSCOPE>
            <title>Heuristic: Conditional Under the Microscope</title>
            <trigger>Use when an `if/else` or `while` condition behaves unexpectedly.</trigger>
            <action>Log the values of all variables in the condition and the boolean result of each sub-part of the condition.</action>
        </CONDITIONAL_UNDER_THE_MICROSCOPE>
        <OBJECT_AUTOPSY_PRE_OPERATION>
            <title>Heuristic: Object Autopsy Pre-Operation</title>
            <trigger>Use when a method call or attribute access on an object fails.</trigger>
            <action>Log the key attributes of the object right before the failing line to check its state.</action>
        </OBJECT_AUTOPSY_PRE_OPERATION>
        <ASSIGNMENT_TRAIL>
            <title>Heuristic: Assignment Trail</title>
            <trigger>Use when a variable has an unexpected value.</trigger>
            <action>Intercept the last assignment to the variable, log the value of the right-hand-side expression, then perform the assignment.</action>
        </ASSIGNMENT_TRAIL>
        <FRAMEWORK_DEPENDENCY_HEALTH_CHECK>
            <title>Heuristic: Framework/Dependency Health Check</title>
            <trigger>Use when you suspect the underlying framework or a library is misbehaving.</trigger>
            <action>Insert a "smoke test" â€” a minimal, safe call to the library to check if it's responsive.</action>
        </FRAMEWORK_DEPENDENCY_HEALTH_CHECK>
        <EXTERNAL_IO_FULL_TRANSPARENCY>
            <title>Heuristic: External I/O Full Transparency</title>
            <trigger>Use for errors during API calls, DB queries, or file I/O.</trigger>
            <action>Log all request parameters (masked) before the call, and the full response (status, headers, body) after the call.</action>
        </EXTERNAL_IO_FULL_TRANSPARENCY>
        <PHANTOM_EXCEPTION_HUNT>
            <title>Heuristic: Phantom Exception Hunt</title>
            <trigger>Use when you suspect an exception is being "swallowed" by a generic `except` block.</trigger>
            <action>Wrap the suspicious code in a `try...except Exception as e:` block, log the exception with full traceback, then immediately re-`raise` it.</action>
        </PHANTOM_EXCEPTION_HUNT>
        <LOOP_ITERATION_TRACE>
            <title>Heuristic: Loop Iteration Trace</title>
            <trigger>Use for issues inside a loop.</trigger>
            <action>At the start of each iteration, log the loop index and the state of key variables.</action>
        </LOOP_ITERATION_TRACE>
        <POST_DEBUGGING_ACTIONS_PROTOCOL>
            <title>Protocol: Post-Debugging Actions</title>
            <desc>Mandatory cleanup procedure after dynamic logging.</desc>
            <ON_SUCCESS>Insert a `# BUG_FIX_CONTEXT:` comment, then remove or comment out temporary logs.</ON_SUCCESS>
            <ON_FAILURE>Comment out all attempted logs as `# DYNAMIC_LOG_ATTEMPT:` and summarize the findings.</ON_FAILURE>
        </POST_DEBUGGING_ACTIONS_PROTOCOL>
    </HEURISTICS_LIBRARY>

</DebuggingSkillset>