<?xml version="1.0" encoding="UTF-8"?>
<FrameworkAgreements version="1.2_FINAL">
    <purpose>
        This module documents the mutual agreements between the user and the AI agent on data formats and operational standards.
        Understanding and adhering to these agreements is a non-negotiable "Law" for our collaboration to be smooth, predictable, and effective.
    </purpose>

    <CONTEXT_PRIMING>
        <title>Context Priming for Framework Agreements</title>
        <desc>These are the core operational "Laws" of our collaboration, covering data formats, safety, and code structure.</desc>
        <keywords>agreements:10|standards:9|protocol:8|format:8|patch:9|markup:9|safety:9|logging:8</keywords>
        <terms>SHARED_AGREEMENTS|DATA_FORMATS|OPERATIONAL_PROTOCOLS|SEMANTIC_INTEGRITY|ATOMIC_OPERATIONS</terms>
    </CONTEXT_PRIMING>

    <AGREEMENTS>
        <PATCH_FILE_FORMAT_AGREEMENT>
            <title>Agreement on Patch File Format</title>
            <desc>This defines our agreed-upon format for patch files, ensuring that code modifications are atomic and unambiguous.</desc>
            <keywords>patch:10|format:9|update:8|insert:8|delete:8|atomic:7</keywords>
            <terms>PATCH_FILE_FORMAT|ATOMIC_UPDATE|TRANSACTIONAL_INSERT|SAFE_DELETE</terms>
            <SPECIFICATION>
                <requirement>A patch file must start with a header: `#PATCH_ID`, `#PURPOSE`, `#TARGET_FILE`.</requirement>
                <requirement>The header is followed by one or more patch blocks, each with a specific operation.</requirement>
                <OPERATION>
                    <name>UPDATE</name>
                    <syntax>`#$$START_PATCH_BLOCK<N> [UPDATE] [TARGET: <START_ANCHOR_NAME>]`</syntax>
                    <rule>The content must be the full, new version of the semantically-marked code block.</rule>
                </OPERATION>
                <OPERATION>
                    <name>INSERT</name>
                    <syntax>`#$$START_PATCH_BLOCK<N> [INSERT] [BETWEEN: <PRECEDING_END_ANCHOR_NAME> AND: <SUCCEEDING_START_ANCHOR_NAME>]`</syntax>
                    <rule>The content must be a new, self-contained code block. Use `EOF` to insert at the end of the file.</rule>
                </OPERATION>
                <OPERATION>
                    <name>DELETE</name>
                    <syntax>`#$$START_PATCH_BLOCK<N> [DELETE] [BETWEEN: <START_ANCHOR_NAME> AND: <END_ANCHOR_NAME>]`</syntax>
                    <rule>The content block MUST be empty. The operation removes the entire slice, including the anchors.</rule>
                </OPERATION>
            </SPECIFICATION>
            <CONSTRAINT>
                <rule>All patch blocks within a single file must target distinct, non-overlapping entities.</rule>
            </CONSTRAINT>
        </PATCH_FILE_FORMAT_AGREEMENT>

        <CODE_MARKUP_AGREEMENT>
            <title>Agreement on Source Code Semantic Markup</title>
            <desc>We agree to use and consistently maintain a rich semantic markup within source code to facilitate understanding, navigation, and automated analysis.</desc>
            <keywords>markup:10|semantic:9|anchor:8|contract:8|code_structure:7</keywords>
            <terms>SEMANTIC_MARKUP|CODE_ANCHORS|MODULE_CONTRACT</terms>
            <SPECIFICATION>
                <requirement>The markup is embedded in code files as special comments (e.g., `# START...`).</requirement>
                <requirement>This markup MUST be preserved and updated during any code modification to maintain its value.</requirement>
                <reference>The definitive source for the full annotation syntax and examples is the separate document named `semantic_template.txt`.</reference>
                <key_structures>Includes `START_MODULE_CONTRACT`, `START_MODULE_MAP`, `START_FUNCTION_...`, `START_CONTRACT`, `START_BLOCK_...`, and their corresponding `END_...` tags.</key_structures>
            </SPECIFICATION>
        </CODE_MARKUP_AGREEMENT>

        <MODIFICATION_SAFETY_AGREEMENT>
            <title>Agreement on Safe Code Modification</title>
            <desc>To ensure safety and prevent corruption, we agree that all code modifications will follow strict, atomic procedures.</desc>
            <keywords>safety:10|atomic:9|immutable:8|safe_edit:8|constraints:7</keywords>
            <terms>MODIFICATION_SAFETY|ATOMIC_OPERATIONS|SEMANTIC_INTEGRITY</terms>
            <SPECIFICATION>
                <requirement>Code modifications must be performed by replacing complete logical blocks defined by paired `#START_...` and `#END_...` tags.</requirement>
                <requirement>Alternatively, modifications must use the explicit operations defined in the `PATCH_FILE_FORMAT_AGREEMENT`.</requirement>
                <prohibition>Partial, line-by-line edits that could break the semantic structure are considered unsafe and are forbidden.</prohibition>
            </SPECIFICATION>
        </MODIFICATION_SAFETY_AGREEMENT>

        <LOGGING_FORMAT_AGREEMENT>
            <title>Agreement on Structured Logging Format</title>
            <desc>We agree on a standardized, structured log format to enable reliable, automated debugging and analysis.</desc>
            <keywords>logging:10|structured_log:9|log_format:8|telemetry:7|diagnostics:8</keywords>
            <terms>LOGGING_STANDARD|STRUCTURED_LOGS|LOG_TO_CODE_CORRELATION</terms>
            <SPECIFICATION>
                <requirement>All generated or modified applications should be configured to write logs to `application.log`.</requirement>
                <requirement>The log message format must follow the semantic structure: `f"[{CLASSIFIER}][{FUNCTION_NAME}][{BLOCK_NAME}][{OPERATION_TYPE}] Description [{STATUS}]"`.</requirement>
                <rationale>This structure is critical for the "Log-to-Code Correlation" technique, as it allows for direct navigation from a log entry to the exact line of code that generated it.</rationale>
            </SPECIFICATION>
        </LOGGING_FORMAT_AGREEMENT>
    </AGREEMENTS>
</FrameworkAgreements>