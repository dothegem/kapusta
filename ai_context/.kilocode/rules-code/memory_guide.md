# Руководство по Работе с Графовой Базой Знаний (`memory` MCP)

**Приоритеты:** Файлы с артефактами (`.md`, `.xml`) являются **основным и наиболее приоритетным источником знаний** для решения текущей задачи. Графовая база `memory` — это **дополнение**: долгосрочная, индексированная база ключевых, переиспользуемых фактов.

---

### 1. Корневая Онтология Графа

Вы должны придерживаться следующей структуры при работе с графом:

*   **`User`:** Узел, представляющий пользователя.
    *   *Наблюдения:* его глобальные предпочтения.
*   **`Projects`:** Узел-коллекция для всех проектов.
    *   *Связи:* `CONTAINS` -> `[Имя Проекта]`.
*   **`[Имя Проекта]` (Тип: `Project`):** Узел для конкретного проекта.
    *   *Наблюдения:* `Artifact: AppGraph.xml`, `Artifact: rules.md`.
    *   *Связи:* `USES` -> `Technology`, `HAS_ENVIRONMENT` -> `[Имя Проекта]_Environment`, `HAS_BACKLOG_ITEM` -> `BacklogItem`.
*   **`Technology`:** Узел для технологии или библиотеки (`pandas`, `FastAPI`).
    *   *Наблюдения:* проверенные версии (`version==2.1.0`).
*   **`Environment` (Глобальный):** Узел для общих особенностей среды выполнения (например, "последняя стабильная версия Python").
*   **`[Имя Проекта]_Environment` (Тип: `Environment`, Проектный):** Узел со специфичными для проекта версиями из `requirements.txt`.
*   **`BacklogItem`:** Узел, представляющий задачу или идею в бэклоге проекта.
    *   *Наблюдения:* `status: todo/in_progress/done`, `priority: high/medium/low`.
*   **`ImportantNotice`:** Узел для критически важных знаний, не вошедших в другие категории.

---

### 2. Ритуал Загрузки Контекста (Начало сессии)

В начале каждой новой задачи вы должны выполнить:

1.  **Обязательная загрузка:**
    *   Запросить из `memory` все узлы с типом `User`, `Environment` (глобальный) и `ImportantNotice`.
2.  **Опциональная загрузка:**
    *   Запросить узел `Projects` и его связи, чтобы получить список всех проектов.
    *   Если задача относится к конкретному проекту, дополнительно запросить узел этого проекта и связанные с ним `BacklogItem` и проектный `Environment`.

---

### 3. Правила Записи в Граф

*   **Когда записывать:** Если в ходе выполнения задачи вы обнаружили важное, **переиспользуемое знание**, вы обязаны зафиксировать его в графе.
*   **Что записывать (Примеры):**
    *   **`Architect`:** "Пользователь утвердил `FastAPI` для нового сервиса" -> создать узел `Technology`, связать его с проектом.
    *   **`Code`:** "Скрипт `test_lib.py` показал `pandas==2.1.0`" -> обновить проектный узел `Environment`.
    *   **`Orchestrator`:** "Пользователь добавил новую фичу в бэклог" -> создать узел `BacklogItem` и связать его с проектом.