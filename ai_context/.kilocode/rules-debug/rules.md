# Основной рабочий процесс режима "Debug"

Ваша главная задача в этом режиме — **систематическая диагностика и устранение проблем**. Вы должны действовать как хирург: точно определить проблему, подтвердить диагноз и аккуратно ее исправить.

**Рабочий процесс пошагово:**

*   **Шаг 1: `ANALYZE_THE_CONTEXT` (Анализ Контекста)**
    *   **Цель:** Собрать всю доступную информацию о проблеме.
    *   **Действия:**
        1.  Внимательно изучите сообщение об ошибке, стек вызовов (traceback) и любые предоставленные пользователем данные.
        2.  **Проверьте лог-файл:** Найдите и изучите `app.log` на предмет сообщений об ошибках или предупреждений, предшествующих сбою. Используйте `search_files` для поиска по ID запроса или временным меткам.
        3.  Сформулируйте 2-3 наиболее вероятные гипотезы о причине проблемы.

*   **Шаг 2: `CONFIRM_THE_DIAGNOSIS` (Подтверждение Диагноза)**
    *   **Цель:** Подтвердить одну из гипотез с помощью точечного сбора данных, а не немедленного исправления.
    *   **Действия:**
        1.  Если существующей информации недостаточно для однозначного вывода, **не пытайтесь "угадать" исправление**.
        2.  **Примените Динамическое Логирование:** Используйте одну или несколько эвристик из гайда `.kilocode/rules-debug/dynamic_logging_heuristics.md` для добавления временных, сверхдетальных логов в проблемный участок кода.
        3.  Заявите о своем намерении: "Я добавлю логирование в `function_name`, чтобы проверить значение переменной `X`".
        4.  После добавления логов, попросите пользователя перезапустить код и предоставить обновленный `app.log`.

*   **Шаг 3: `PROPOSE_THE_FIX` (Предложение Исправления)**
    *   **Цель:** Разработать и предложить точечное исправление на основе подтвержденного диагноза.
    *   **Действия:**
        1.  Проанализировав новые логи, четко сформулируйте причину проблемы.
        2.  **Явно спросите у пользователя:** "Судя по логам, проблема в том, что `X` имеет значение `None`. Я предлагаю добавить проверку на `None` перед этой строкой. Приступить к исправлению?"
        3.  **Не приступайте к исправлению без явного согласия пользователя.**

*   **Шаг 4: `IMPLEMENT_THE_FIX` (Реализация Исправления)**
    *   **Цель:** Аккуратно внести согласованные изменения.
    *   **Действия:**
        1.  Используйте `apply_diff` для внесения исправления.
        2.  Следуйте "Протоколу Очистки" из гайда по эвристикам: добавьте комментарий `# BUG_FIX_CONTEXT:`, удалите временные логи и, при необходимости, сохраните самые полезные в виде комментариев (`# RETAINED_DEBUG_LOG:`).
